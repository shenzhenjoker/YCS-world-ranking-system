
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>世界大师杯排名系统</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('./assets/background.png') no-repeat center center fixed;
      background-size: cover;
      color: #f2f2f2;
      overflow-x: hidden;
    }
    header {
      background-color: rgba(0,0,0,0.7);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header img.logo {
      height: 60px;
    }
    .title-box {
      flex-grow: 1;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      transition: all 0.3s ease-in-out;
    }
    .lang-box {
      font-size: 14px;
    }
    .event-select {
      margin: 20px auto;
      text-align: center;
    }
    select {
      padding: 6px 10px;
      font-size: 16px;
      border-radius: 4px;
    }
    table {
      width: 90%;
      margin: 10px auto;
      border-collapse: collapse;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      overflow: hidden;
      animation: fadeIn 0.6s ease-in;
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 16px;
    }
    th {
      background-color: rgba(255,255,255,0.1);
    }
    tr {
      transition: background 0.3s ease, transform 0.2s ease;
    }
    tr:hover {
      background-color: rgba(255,255,255,0.08);
      transform: scale(1.01);
    }
    .rank-icon {
      font-size: 22px;
      animation: popIn 0.4s ease-in-out;
    }
    .refresh-note {
      text-align: center;
      margin: 10px;
      font-size: 14px;
      color: #aaa;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes popIn {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .highlight {
      animation: flash 1s ease-in-out;
    }

    @keyframes flash {
      0% { background-color: rgba(255, 215, 0, 0.2); }
      100% { background-color: transparent; }
    }
  </style>
</head>
<body>
  <header>
    <img src="./assets/logo.png" class="logo" alt="Logo"/>
    <div class="title-box" id="page-title">加载中...</div>
    <div class="lang-box">
      <button onclick="switchLang('en')">EN</button> | <button onclick="switchLang('zh')">中</button>
    </div>
  </header>

  <div class="event-select">
    <label id="label-event">选择赛事：</label>
    <select id="eventSelect" onchange="switchEvent()">
      <option value="tokyo">东京站</option>
      <option value="shanghai">上海站</option>
    </select>
  </div>

  <table id="rankingTable">
    <thead>
      <tr>
        <th id="th-rank">名次</th>
        <th id="th-country">国家</th>
        <th id="th-name">选手</th>
        <th id="th-result">成绩</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="refresh-note" id="refreshText">自动每 10 秒刷新一次</div>

  <script>
    let currentLang = "zh";
    let currentEvent = "tokyo";
    let lastData = [];

    const langPack = {
      zh: {
        label_event: "选择赛事：",
        th_rank: "名次", th_country: "国家", th_name: "选手", th_result: "成绩",
        refresh: "自动每 10 秒刷新一次"
      },
      en: {
        label_event: "Select Event:",
        th_rank: "Rank", th_country: "Country", th_name: "Athlete", th_result: "Result",
        refresh: "Auto refresh every 10 seconds"
      }
    };

    function switchLang(lang) {
      currentLang = lang;
      document.getElementById("label-event").innerText = langPack[lang].label_event;
      document.getElementById("th-rank").innerText = langPack[lang].th_rank;
      document.getElementById("th-country").innerText = langPack[lang].th_country;
      document.getElementById("th-name").innerText = langPack[lang].th_name;
      document.getElementById("th-result").innerText = langPack[lang].th_result;
      document.getElementById("refreshText").innerText = langPack[lang].refresh;

      fetch("title.json").then(r => r.json()).then(t => {
        document.getElementById("page-title").innerText = t[lang];
      });
    }

    function switchEvent() {
      currentEvent = document.getElementById("eventSelect").value;
      loadData();
    }

    function loadData() {
      fetch(`result.json`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#rankingTable tbody");
          tbody.innerHTML = '';
          data.forEach((row, i) => {
            const tr = document.createElement("tr");
            tr.classList.add("fadeIn");
            if (!lastData[i] || lastData[i].name !== row.name) {
              tr.classList.add("highlight");
            }
            lastData[i] = row;

            let icon = '';
            if (i === 0) icon = '🥇';
            else if (i === 1) icon = '🥈';
            else if (i === 2) icon = '🥉';
            else icon = i + 1;

            tr.innerHTML = `
              <td class="rank-icon">${icon}</td>
              <td>${row.nationality}</td>
              <td>${row.name}</td>
              <td>${row.result}</td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    switchLang("zh");
    loadData();
    setInterval(loadData, 10000);
  </script>
</body>
</html>
